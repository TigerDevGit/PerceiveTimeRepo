#!/usr/bin/env node

var fs = require('fs')
var _ = require('lodash')
var Handlebars = require('handlebars')
var meetData = require('../data/meetings.json')

var meetingIds = {}
meetData.meetings.forEach(function (meeting) {
  var meetingId = meeting.id
  if (meetingIds[meetingId]) {
    console.log('ERROR: Multiple meetings are using the same `id`.')
    process.exit(1)
  }
  meetingIds[meetingId] = meeting
})

if (_.endsWith(process.cwd(), '/bin')) process.chdir('..')
var meetPage = fs.readFileSync('app/static-pages/meet/index.hbs').toString()

Handlebars.registerHelper('left_or_right', function (conditional) {
  return (conditional % 2 == 0) ? 'right' : 'left'
})

var template = Handlebars.compile(meetPage)
var result = template(meetData)
fs.writeFileSync('dist/meet/index.html', result)
